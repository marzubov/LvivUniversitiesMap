//>>built
define("dojo/_base/lang dojo/Deferred dojo/_base/array dojo/promise/all jimu/portalUtils jimu/SpatialReference/wkidUtils esri/request".split(" "),function(f,h,k,p,m,q,r){function l(a){if(null===a)return a;var c=a.indexOf("?");return 0===a.indexOf("http")&&-1!==c?a.slice(0,c):a}function n(a){var c=[];k.forEach(a,function(a){c.push(a.url)});c.sort();a="";for(var b=0,b=0;b<c.length;b++){var d=c[b].indexOf("?"),e="",e=-1!==d?c[b].slice(0,d):c[b];a+=e}return a.replace(/\ /,"")}function s(a){var c=!1;if(a)for(var b=
0;b<a.length;b++)if(a[b].type){c=!0;break}return c}function t(a,c){var b=null,d=new h;c.spatialReference||a.spatialReference?(b=c.spatialReference||a.spatialReference,d.resolve(b)):s(c.baseMap.baseMapLayers)?(b={wkid:"102100"},d.resolve(b)):c.baseMap.baseMapLayers&&c.baseMap.baseMapLayers[0]?r({url:c.baseMap.baseMapLayers[0].url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(f.hitch(this,function(a){a.spatialReference&&(b=a.spatialReference);d.resolve(b)}),f.hitch(this,function(){d.resolve(b)})):
d.resolve(b);return d}return{_loadPortalBaseMaps:function(a,c){var b=new h,d=[];m.getWebMapsFromBasemapGalleryGroup(a).then(function(a){k.forEach(a.results,function(a){var b=new h;d.push(b);a.getItemData().then(function(e){t(a,e).then(f.hitch(this,function(d){var f=[];if(c&&d&&q.isSameSR(c.wkid,d.wkid)){var f=k.map(e.baseMap.baseMapLayers,function(a){return a}),g=null;a.thumbnailUrl&&(g=a.thumbnailUrl.indexOf("?"),g=-1!==g?a.thumbnailUrl.slice(0,g):a.thumbnailUrl);b.resolve({layers:f,title:a.title,
thumbnailUrl:g,spatialReference:d})}else b.resolve({})}))})});p(d).then(function(a){b.resolve(a)})},function(a){b.reject(a)});return b},compareSameBasemap:function(a,c){var b=c.layers,d="",e="",d=n(a.layers),e=n(b);return d===e},compareSameBasemapByOrder:function(a,c){var b=a.layers,d=c.layers;if(b.length!==d.length)return!1;for(var e=0;e<b.length;e++)if(b[e].type||(b[e].type=null),d[e].type||(d[e].type=null),b[e].type!==d[e].type||!b[e].type&&!b[e].type&&(b[e].url||(b[e].url=null),d[e].url||(d[e].url=
null),l(b[e].url)!==l(d[e].url)))return!1;return!0},isBingMap:function(a){if(!a||!a.layers)return!1;for(var c=0;c<a.layers.length;c++)if("BingMapsAerial"===a.layers[c].type||"BingMapsRoad"===a.layers[c].type||"BingMapsHybrid"===a.layers[c].type)return!0;return!1},isNoUrlLayerMap:function(a){if(!a||!a.layers)return!1;for(var c=0;c<a.layers.length;c++)if("BingMapsAerial"===a.layers[c].type||"BingMapsRoad"===a.layers[c].type||"BingMapsHybrid"===a.layers[c].type||"OpenStreetMap"===a.layers[c].type)return!0;
return!1},getToken:function(a){a=m.getPortal(a);a.updateCredential();return a.credential?"?token\x3d"+a.credential.token:""},removeUrlQuery:function(a){return l(a)}}});