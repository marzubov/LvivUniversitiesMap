//>>built
require({cache:{"url:widgets/Query/setting/PopupConfig.html":'\x3cdiv\x3e\r\n\t\x3cdiv style\x3d"margin-top:22px;margin-bottom:16px;font-size:12px;"\x3e${nls.resultSettingTip}\x3c/div\x3e\r\n\t\x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.resultItemTitle}:\x3c/div\x3e\t\r\n\t\x3ctable style\x3d"width:100%;"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\t\t\t\t\r\n\t\t\t\t\x3ctd style\x3d"width:auto;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"titleTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d\'required:true,trim:true\' style\x3d"width:430px;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"padding-left:30px;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAddFields" class\x3d"add-with-icon enable" data-dojo-attach-event\x3d"onclick:_onAddClicked"\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"add-icon"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addField}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv style\x3d"margin-top:16px;"\x3e${nls.resultItemContent}:\x3c/div\x3e\r\n\t\x3cdiv style\x3d"margin-top:7px;margin-bottom:8px;font-size:12px;"\x3e${nls.fieldsSetTip}\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"fieldsContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PopupConfig.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query jimu/dijit/SimpleTable dijit/form/TextBox dijit/TooltipDialog dijit/Menu dijit/MenuItem dijit/popup".split(" "),function(k,l,m,n,p,b,c,e,q,g,r,u,s,t,h,f){return k([l,m,n],{baseClass:"query-setting-popup-config",templateString:p,nls:null,sqs:null,config:null,postCreate:function(){this.inherited(arguments);this._initFieldsTable();
this._initAddFields();this.clear();this.config&&this.setConfig(this.config)},setConfig:function(a){this.clear();this.config=b.mixin({},a);this.config.title&&"string"===typeof this.config.title?this.titleTextBox.set("value",this.config.title||""):this.titleTextBox.set("value","");this.config.fields&&0<this.config.fields.length&&this._setFields(this.config.fields)},getConfig:function(){var a={title:"",fields:[]};if(!this.titleTextBox.validate())return this.sqs.showResultsSetting(),this.sqs.scrollToDom(this.titleTextBox.domNode),
this.sqs.showValidationErrorTip(this.titleTextBox),null;a.title=this.titleTextBox.get("value");var d=this.fieldsTable.getRows(),c=[];e.forEach(d,b.hitch(this,function(d){var b=this.fieldsTable.getRowData(d);b.visibility?c.push({name:b.name,alias:b.alias,type:d.fieldType,specialType:b.specialType,showInInfoWindow:!0}):0<=a.title.indexOf("${"+b.name+"}")&&c.push({name:b.name,alias:b.alias,type:d.fieldType,specialType:b.specialType,showInInfoWindow:!1})}));a.fields=c;return a},clear:function(){this.fields=
null;this.titleTextBox.set("value","");this.fieldsTable.clear();this._resetMenu();this._addEmptyMenuItem()},destroy:function(){this.sqs=null;this.titleTextBox.focusNode.blur();this.inherited(arguments)},_initFieldsTable:function(){var a={autoHeight:!1,style:"height:200px",fields:[{name:"visibility",title:this.nls.visibility,type:"checkbox"},{name:"name",title:this.nls.name,type:"text",editable:!1},{name:"alias",title:this.nls.alias,type:"text",editable:!0},{name:"specialType",title:this.nls.specialType,
type:"extension",create:b.hitch(this,this._createSpecialType),setValue:b.hitch(this,this._setValue4SpecialType),getValue:b.hitch(this,this._getValueOfSpecialType)},{name:"actions",title:this.nls.actions,type:"actions",actions:["up","down"]}]};this.fieldsTable=new r(a);this.fieldsTable.placeAt(this.fieldsContainer);this.fieldsTable.startup()},_createSpecialType:function(a){a=c.create("select",{},a);c.create("option",{value:"none",label:this.nls.none,selected:!0},a);c.create("option",{value:"link",
label:this.nls.link},a);c.create("option",{value:"image",label:this.nls.image},a)},_setValue4SpecialType:function(a,d){g("select",a)[0].value=d},_getValueOfSpecialType:function(a){return g("select",a)[0].value},_initAddFields:function(){var a=c.create("div");this.tooltipDialog=new s({style:"cursor:pointer",content:a});this.menu=new t;this.menu.placeAt(a);this.own(q(window,"click",b.hitch(this,function(){f.close(this.tooltipDialog)})))},_onAddClicked:function(a){a.stopPropagation();a.preventDefault();
f.close(this.tooltipDialog);f.open({popup:this.tooltipDialog,around:this.btnAddFields})},_resetMenu:function(){var a=this.menu.getChildren();e.forEach(a,b.hitch(this,function(a){this.menu.removeChild(a)}))},_addEmptyMenuItem:function(){var a=new h({label:this.nls.noField,onClick:b.hitch(this,function(){var a=this.menu.getParent();c.setStyle(a.domNode.parentNode,"display","none")})});this.menu.addChild(a)},_setFields:function(a){this._resetMenu();this.fields=e.filter(a,function(a){return"esriFieldTypeGeometry"!==
a.type});0<this.fields.length?e.forEach(this.fields,b.hitch(this,function(a){this._addMenuItem(a);this._addRow(a)})):this._addEmptyMenuItem()},_addMenuItem:function(a){var d=new h({label:a.name+" {"+a.name+"}",onClick:b.hitch(this,function(){var b=this.titleTextBox.get("value")+"${"+a.name+"}";this.titleTextBox.set("value",b);b=this.menu.getParent();c.setStyle(b.domNode.parentNode,"display","none")})});this.menu.addChild(d)},_addRow:function(a){var b=this.fieldsTable.addRow({visibility:a.visible,
name:a.name,alias:a.alias||a.name,specialType:a.specialType||"none"});b.success&&(b.tr.fieldType=a.type)}})});